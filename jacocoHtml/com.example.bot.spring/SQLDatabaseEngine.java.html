<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SQLDatabaseEngine.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">sample-spring-boot-kitchensink</a> &gt; <a href="index.source.html" class="el_package">com.example.bot.spring</a> &gt; <span class="el_source">SQLDatabaseEngine.java</span></div><h1>SQLDatabaseEngine.java</h1><pre class="source lang-java linenums">package com.example.bot.spring;

import lombok.extern.slf4j.Slf4j;
import javax.annotation.PostConstruct;
import javax.sql.DataSource;
import java.sql.*;
import java.util.List;
import java.net.URISyntaxException;
import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.URI;
import java.util.Date;
import java.util.Calendar;
import java.util.*;
import java.util.Random;

//@Slf4j



/**
 * The SQLDatabaseEngine implements functions that
 * communicate with the database and get/update the related data.
 * 
 * @author Grp34
 * @version 1.0
 * @since  2017-11-01
 */
<span class="fc" id="L30">public class SQLDatabaseEngine extends DatabaseEngine{	</span>
	
/**
 * This method is used to create new user info in our database.
 * Data stored will be needed in order for other functions to work.
 * The data is bound to the userID, which is unique for each user.
 * Return statement for new user and users that have previously used
 * the chatbot will be slightly different.
 * 
 * @param userId This is the unique user ID generated by Line
 * @return String This returns the result of the initialization
 * @exception SQLException If userID already exist in user_info table
 */
	public String InitializeNewUser(String userId) throws Exception {
<span class="fc" id="L44">		String result = null;</span>
<span class="fc" id="L45">		int user_count = 0;</span>
<span class="fc" id="L46">		boolean data_exist = false;</span>
<span class="fc" id="L47">		int today = 0;</span>
<span class="fc" id="L48">		Calendar c = Calendar.getInstance();</span>
		//Date d = c.getTime();
		//c.setTime(d);
<span class="fc" id="L51">		today = c.get(Calendar.DAY_OF_YEAR);</span>
<span class="fc" id="L52">		Connection connection = getConnection();</span>
		
		//Create data in user_info
<span class="fc" id="L55">		PreparedStatement stmt1 = connection.prepareStatement(&quot;INSERT INTO user_info VALUES (? , 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 'nothing', 'nothing', '0', 0, 0, 'default', ?)&quot;);</span>
<span class="fc" id="L56">		stmt1.setString(1, userId);</span>
<span class="fc" id="L57">		stmt1.setInt(2,today);</span>
<span class="fc" id="L58">		stmt1.executeUpdate();</span>

		
		// Add data to coupontable
<span class="fc" id="L62">		PreparedStatement stmt2 = connection.prepareStatement(&quot;SELECT user_number from coupontable where user_id = 'master'&quot;);</span>
<span class="fc" id="L63">		ResultSet rs = stmt2.executeQuery();</span>
<span class="pc bpc" id="L64" title="1 of 2 branches missed.">		if (rs.next()) {</span>
<span class="fc" id="L65">		user_count = rs.getInt(1);</span>
		}


<span class="fc" id="L69">		PreparedStatement stmt3 = connection.prepareStatement(&quot;SELECT * from coupontable where user_id = ?&quot;);</span>
<span class="fc" id="L70">		stmt3.setString(1, userId);</span>
<span class="fc" id="L71">		ResultSet rs2 = stmt3.executeQuery();</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">		if (rs2.next()) {</span>
<span class="fc" id="L73">			data_exist = true;</span>
		}
<span class="fc bfc" id="L75" title="All 2 branches covered.">		if(!data_exist)</span>
		{
<span class="fc" id="L77">		user_count++;</span>
<span class="fc" id="L78">		PreparedStatement stmt4 = connection.prepareStatement(&quot;INSERT INTO coupontable VALUES (? , ?, false, 0)&quot;);</span>
<span class="fc" id="L79">		stmt4.setString(1, userId);</span>
<span class="fc" id="L80">		stmt4.setInt(2, user_count);</span>
<span class="fc" id="L81">		stmt4.executeUpdate();</span>
		
		//Update master user_count
<span class="fc" id="L84">		PreparedStatement stmt5 = connection.prepareStatement(&quot;UPDATE coupontable set user_number = ? where user_id = 'master'&quot;);</span>
<span class="fc" id="L85">		stmt5.setInt(1, user_count);</span>
<span class="fc" id="L86">		stmt5.executeUpdate();</span>
<span class="fc" id="L87">		result = &quot;Data initiallized! Welcome~&quot;;</span>
<span class="fc" id="L88">		return result;</span>
		}
		
<span class="fc" id="L91">		connection.close();</span>
<span class="fc" id="L92">		result = &quot;Data re-created! Unfortunately you are not a new user so you are not qualified for our new user event&quot;;</span>
<span class="fc" id="L93">		return result;</span>
	}
	
	/**
	* This method is used to delete user info in our database.
	* Data stored will be deleted from database.
	* The data is bound to the userID, which is unique for each user.
	* Return acknowledge message to the user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the result of the deletion.
	* @exception SQLException If userID does not exist in database.
	*/
	public String RemoveUser(String userId) throws Exception {
<span class="fc" id="L106">		String result = null;</span>
<span class="fc" id="L107">		Connection connection = getConnection();</span>
<span class="fc" id="L108">		PreparedStatement stmt = connection.prepareStatement(&quot;DELETE FROM user_info WHERE user_id= ?&quot;);</span>
<span class="fc" id="L109">		stmt.setString(1, userId);</span>
<span class="fc" id="L110">		stmt.executeUpdate();</span>
<span class="fc" id="L111">		connection.close();	</span>
<span class="fc" id="L112">		result = &quot;Data Deleted sucessfully!&quot;;</span>
<span class="fc" id="L113">		return result;</span>
	}
	
	/**
	* This method is used to get info state in our database for a particular user.
	* Info state is used to determine which information user will be setting the next time they input. 
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the current state.
	* @exception SQLException If errors occured in database.
	*/
	public String getInfoState(String userId) throws Exception { 
<span class="fc" id="L124">		String state = &quot;default&quot;;</span>
<span class="fc" id="L125">		Connection connection = getConnection();</span>
<span class="fc" id="L126">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT info_state FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L127">		stmt.setString(1, userId);</span>
<span class="fc" id="L128">		ResultSet rs = stmt.executeQuery();</span>
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">		if(rs.next()) {</span>
<span class="fc" id="L130">			state = rs.getString(1);</span>
<span class="fc" id="L131">			connection.close();</span>
<span class="fc" id="L132">			return state;</span>
		}else {
<span class="nc" id="L134">			connection.close();</span>
<span class="nc" id="L135">			return state;</span>
		}
	}
	
	/**
	* This method is used to set info state in our database for a particular user.
	* Info state is used to determine which information user will be setting the next time they input. 
	* @param text This will be the next info_state of the user
	* @param userId This is the unique user ID generated by Line.
	* @exception SQLException If errors occured in database.
	*/
	public void setInfoState(String text, String userId) throws Exception{
<span class="fc" id="L147">		Connection connection = getConnection();</span>
<span class="fc" id="L148">		PreparedStatement stmt = connection.prepareStatement(&quot;UPDATE user_info set info_state = ? where user_id = ?&quot;);</span>
<span class="fc" id="L149">		stmt.setString(1, text);</span>
<span class="fc" id="L150">		stmt.setString(2, userId);</span>
<span class="fc" id="L151">		stmt.executeUpdate();</span>
<span class="fc" id="L152">		connection.close();</span>
<span class="fc" id="L153">		return;</span>
	}
	
	/**
	* This method is used to set weight (in kg) in our database for a particular user. 
	* @param text This is the input passed by user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns whether the input is valid and if the weight value has been updated.
	* @exception SQLException If errors occured in database.
	* @exception IOException If text entered is not a number.
	*/
	public String weight(String text, String userId) throws Exception {
		//Write your code here
<span class="fc" id="L166">		int weight = 0;</span>
<span class="fc" id="L167">		String result = null;</span>
		String[] items;
<span class="fc" id="L169">		items = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L170">		boolean data_exists = false;</span>
		/*if(items[0] == &quot;weight&quot;) {
			weight = Integer.parseInt(items[1]);
		}else {
			weight = Integer.parseInt(items[0]);
		}*/
<span class="fc" id="L176">		weight = Integer.parseInt(items[0]);</span>
<span class="fc bfc" id="L177" title="All 2 branches covered.">		if(weight&lt;=0)</span>
		{
<span class="fc" id="L179">			result = &quot;Weight can not be zero or negative! Please use the info function again and enter a valid input&quot;;</span>
<span class="fc" id="L180">			return result;</span>
		}
<span class="fc" id="L182">		Connection connection = getConnection();</span>
<span class="fc" id="L183">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L184">		stmt.setString(1, userId);</span>
<span class="fc" id="L185">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L186" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L187">			data_exists = true;</span>
		}
<span class="fc" id="L189">		rs.close();</span>
<span class="fc bfc" id="L190" title="All 2 branches covered.">		if(data_exists)</span>
		{
<span class="fc" id="L192">			PreparedStatement stmt2 = connection.prepareStatement(&quot;UPDATE user_info set weight = ? where user_id = ?&quot;);</span>
<span class="fc" id="L193">			stmt2.setInt(1, weight);</span>
<span class="fc" id="L194">			stmt2.setString(2, userId);</span>
<span class="fc" id="L195">			stmt2.executeUpdate();</span>
<span class="fc" id="L196">			connection.close();</span>
<span class="fc" id="L197">			result = &quot;Data updated! Your weight has been set to &quot; + weight + &quot;kg&quot;;</span>
		}
<span class="fc" id="L199">			return result;</span>
		
	}
	
	/**
	* This method is used to set height (in cm) in our database for a particular user.
	* @param text This is the input passed by user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns whether the input is valid and if the height value has been updated.
	* @exception IOException If text entered is not a number.
	*/
	public String height(String text, String userId) throws Exception {
		//Write your code here
<span class="fc" id="L212">		int height = 0;</span>
<span class="fc" id="L213">		String result = null;</span>
		String[] items;
<span class="fc" id="L215">		items = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L216">		boolean data_exists = false;</span>
<span class="fc" id="L217">		height = Integer.parseInt(items[0]);</span>
<span class="fc bfc" id="L218" title="All 2 branches covered.">		if(height&lt;=0)</span>
		{
<span class="fc" id="L220">			result = &quot;Height can not be zero or negative! Please use the info function again and enter a valid input&quot;;</span>
<span class="fc" id="L221">			return result;</span>
		}
<span class="fc" id="L223">		Connection connection = getConnection();</span>
<span class="fc" id="L224">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L225">		stmt.setString(1, userId);</span>
<span class="fc" id="L226">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L227" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L228">			data_exists = true;</span>
		}
<span class="fc" id="L230">		rs.close();</span>
<span class="fc bfc" id="L231" title="All 2 branches covered.">		if(data_exists)</span>
		{
<span class="fc" id="L233">			PreparedStatement stmt2 = connection.prepareStatement(&quot;UPDATE user_info set height = ? where user_id = ?&quot;);</span>
<span class="fc" id="L234">			stmt2.setInt(1, height);</span>
<span class="fc" id="L235">			stmt2.setString(2, userId);</span>
<span class="fc" id="L236">			stmt2.executeUpdate();</span>
<span class="fc" id="L237">			connection.close();</span>
<span class="fc" id="L238">			result = &quot;Data updated! Your height has been set to &quot; + height + &quot;cm&quot;;</span>
		}
<span class="fc" id="L240">			return result;</span>
		
	}
	
	/**
	* This method is used to set age in our database for a particular user.
	* @param text This is the input passed by user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns whether the input is valid and if the age value has been updated.
	* @exception IOException If text entered is not a number.
	*/
	public String age(String text, String userId) throws Exception {
		//Write your code here
<span class="fc" id="L253">		int age = 0;</span>
<span class="fc" id="L254">		String result = null;</span>
		String[] items;
<span class="fc" id="L256">		items = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L257">		boolean data_exists = false;</span>
<span class="fc" id="L258">		age = Integer.parseInt(items[0]);</span>
<span class="fc bfc" id="L259" title="All 2 branches covered.">		if(age&lt;=0)</span>
		{
<span class="fc" id="L261">			result = &quot;Age can not be zero or negative! Please use the info function again and enter a valid input&quot;;</span>
<span class="fc" id="L262">			return result;</span>
		}
<span class="fc" id="L264">		Connection connection = getConnection();</span>
<span class="fc" id="L265">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L266">		stmt.setString(1, userId);</span>
<span class="fc" id="L267">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L268" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L269">			data_exists = true;</span>
		}
<span class="fc" id="L271">		rs.close();</span>
<span class="fc bfc" id="L272" title="All 2 branches covered.">		if(data_exists)</span>
		{
<span class="fc" id="L274">			PreparedStatement stmt2 = connection.prepareStatement(&quot;UPDATE user_info set age = ? where user_id = ?&quot;);</span>
<span class="fc" id="L275">			stmt2.setInt(1, age);</span>
<span class="fc" id="L276">			stmt2.setString(2, userId);</span>
<span class="fc" id="L277">			stmt2.executeUpdate();</span>
<span class="fc" id="L278">			connection.close();</span>
<span class="fc" id="L279">			result = &quot;Data updated! Your age has been set to &quot; + age;</span>
		}
<span class="fc" id="L281">			return result;</span>
		
	}
	
	/**
	* This method is used to set gender in our database for a particular user.
	* @param text This is the input passed by user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns whether the input is valid and if the gender value has been updated.
	* @exception SQLException If error happened in database.
	*/
	public String sex(String text, String userId) throws Exception {
<span class="fc" id="L293">		String result = null;</span>
<span class="fc" id="L294">		boolean data_exists = false;</span>
<span class="fc bfc" id="L295" title="All 4 branches covered.">		if(text.equals(&quot;M&quot;) || text.equals(&quot;F&quot;))</span>
		{
<span class="fc" id="L297">			Connection connection = getConnection();</span>
<span class="fc" id="L298">			PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L299">			stmt.setString(1, userId);</span>
<span class="fc" id="L300">			ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">			if (rs.next()) {</span>
<span class="fc" id="L302">				data_exists = true;</span>
			}
<span class="fc" id="L304">			rs.close();</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">			if(data_exists)</span>
			{
<span class="fc" id="L307">				PreparedStatement stmt2 = connection.prepareStatement(&quot;UPDATE user_info set sex = ? where user_id = ?&quot;);</span>
<span class="fc" id="L308">				stmt2.setString(1, text);</span>
<span class="fc" id="L309">				stmt2.setString(2, userId);</span>
<span class="fc" id="L310">				stmt2.executeUpdate();</span>
<span class="fc" id="L311">				connection.close();</span>
<span class="fc" id="L312">				result = &quot;Data updated! Your sex has been set to &quot; + text;</span>
			}
<span class="fc" id="L314">				return result;</span>
		}
		else {
<span class="fc" id="L317">			result = &quot;Your Sex is invalid! Please try again using the info function.&quot;;</span>
<span class="fc" id="L318">			return result;</span>
					
		}
	}
	
	/**
	* This method is used to set water interval (in mins) in our database for a particular user.
	* Value set by this function will be used to determine whether a remind message to be generated.
	* @param text This is the input passed by user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns whether the input is valid and if the water_interval value has been updated.
	* @exception IOException If text entered is not a number.
	* @exception SQLException If error in database.
	*/
	public String waterInterval(String text, String userId) throws Exception {
<span class="fc" id="L333">		String result = null;</span>
		String[] items;
<span class="fc" id="L335">		items = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L336">		boolean data_exists = false;</span>
<span class="fc" id="L337">		int interval = Integer.parseInt(items[1]) * 60000;</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">		if(interval&lt;0)</span>
		{
<span class="fc" id="L340">			result =&quot;Interval can't be negative!&quot;;</span>
<span class="fc" id="L341">			return result;</span>
		}
<span class="fc" id="L343">		Connection connection = getConnection();</span>
<span class="fc" id="L344">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L345">		stmt.setString(1, userId);</span>
<span class="fc" id="L346">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L347" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L348">			data_exists = true;</span>
		}
<span class="fc" id="L350">		rs.close();</span>
<span class="fc bfc" id="L351" title="All 2 branches covered.">		if(data_exists)</span>
		{
<span class="fc" id="L353">			PreparedStatement stmt2 = connection.prepareStatement(&quot;UPDATE user_info set water_int = ? where user_id = ?&quot;);</span>
<span class="fc" id="L354">			stmt2.setInt(1, interval);</span>
<span class="fc" id="L355">			stmt2.setString(2, userId);</span>
<span class="fc" id="L356">			stmt2.executeUpdate();</span>
<span class="fc" id="L357">			connection.close();</span>
<span class="fc" id="L358">			result = &quot;Data updated! &quot;;</span>
<span class="fc" id="L359">			return result;</span>
		}
<span class="fc" id="L361">		return result;</span>

	}
	
	/**
	* This method is used to determine whether it is time for us to remind a particular user to drink water.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the reminder message if the time has come.
	* @exception SQLException If error in database.
	*/
	public String waterNotif(String userId) throws Exception {
<span class="fc" id="L372">		String results = &quot;&quot;;</span>
		
		try {
<span class="fc" id="L375">			Date curDT = new Date();</span>
<span class="fc" id="L376">			Connection connection = getConnection();</span>
<span class="fc" id="L377">			PreparedStatement stmt = connection.prepareStatement(&quot;SELECT water_time, water_int FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L378">			stmt.setString(1, userId);</span>
<span class="fc" id="L379">			ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L380" title="All 2 branches covered.">			if (rs.next()) {</span>
<span class="fc" id="L381">				long old_time = rs.getLong(&quot;water_time&quot;);</span>
<span class="pc bpc" id="L382" title="1 of 2 branches missed.">				if (rs.getLong(&quot;water_int&quot;) &lt;= 0) {</span>
<span class="nc" id="L383">					rs.close();</span>
<span class="nc" id="L384">					stmt.close();</span>
<span class="nc" id="L385">					connection.close();</span>
<span class="nc" id="L386">					return results;</span>
<span class="pc bpc" id="L387" title="1 of 2 branches missed.">				} else if (old_time == 0) {</span>
<span class="nc" id="L388">					PreparedStatement stmtSave = connection.prepareStatement(&quot;UPDATE user_info SET water_time = ? WHERE user_id = ?&quot;);</span>
<span class="nc" id="L389">					stmtSave.setLong(1, curDT.getTime());</span>
<span class="nc" id="L390">					stmtSave.setString(2, userId);</span>
<span class="nc" id="L391">					stmtSave.executeUpdate();</span>
<span class="nc" id="L392">					stmtSave.close();</span>
<span class="nc" id="L393">				}</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">				else if (curDT.getTime() &gt; (old_time + rs.getLong(&quot;water_int&quot;))) {</span>
<span class="fc" id="L395">					results = &quot;Remember to drink some water!&quot;;</span>
<span class="fc" id="L396">					PreparedStatement stmtSave = connection.prepareStatement(&quot;UPDATE user_info SET water_time = ? WHERE user_id = ?&quot;);</span>
<span class="fc" id="L397">					stmtSave.setLong(1, curDT.getTime());</span>
<span class="fc" id="L398">					stmtSave.setString(2, userId);</span>
<span class="fc" id="L399">					stmtSave.executeUpdate();</span>
<span class="fc" id="L400">					stmtSave.close();</span>
				}
			}
<span class="fc" id="L403">			rs.close();</span>
<span class="fc" id="L404">			stmt.close();</span>
<span class="fc" id="L405">			connection.close();</span>
<span class="nc" id="L406">		} catch(Exception e) {</span>
<span class="nc" id="L407">			System.out.println(e);</span>
<span class="fc" id="L408">		}</span>
<span class="fc" id="L409">		return results;</span>
	}
	
	/**
	* This method is used to search for nutrient info for a menu/meal.
	* Nutrient info includes weight, energy, sodium, and fat.
	* @param text This is the input passed by user.
	* @return String This returns the nutrients for the input.
	* @exception IOException If input is invalid.
	* @exception SQLException If error in database.
	*/
	public String menu_search(String text) throws Exception {
		String result_set;
		String[] dishes;
<span class="fc" id="L423">		dishes = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L424">		StringBuilder resultbuilder = new StringBuilder();</span>
		try {	
<span class="fc bfc" id="L426" title="All 2 branches covered.">				for(int i=1; i &lt; dishes.length;i++) {</span>
<span class="fc" id="L427">					String[] ingredients = {};</span>
<span class="fc" id="L428">					ingredients = dishes[i].split(&quot; &quot;);</span>
<span class="fc" id="L429">					int weight_total = 0;</span>
<span class="fc" id="L430">					int energy_total = 0;</span>
<span class="fc" id="L431">					int sodium_total = 0;</span>
<span class="fc" id="L432">					int fat_total = 0;</span>
<span class="fc bfc" id="L433" title="All 2 branches covered.">					for(int j=0; j &lt; ingredients.length; j++)</span>
					{
<span class="fc" id="L435">						int weight_avg = 0;</span>
<span class="fc" id="L436">						int energy_avg = 0;</span>
<span class="fc" id="L437">						int sodium_avg = 0;</span>
<span class="fc" id="L438">						int fat_avg = 0;</span>
<span class="fc" id="L439">						int result_count = 0;</span>
<span class="fc" id="L440">						Connection connection = getConnection();</span>
<span class="fc" id="L441">						PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM nutrient_table WHERE description like concat( ?, '%')&quot;);</span>
<span class="fc" id="L442">						stmt.setString(1, ingredients[j]);</span>
<span class="fc" id="L443">						ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L444" title="All 2 branches covered.">						while (rs.next()) {</span>
<span class="fc" id="L445">							result_count++;</span>
<span class="fc" id="L446">							weight_avg += rs.getInt(3);</span>
<span class="fc" id="L447">							energy_avg += rs.getInt(5);</span>
<span class="fc" id="L448">							sodium_avg += rs.getInt(6);</span>
<span class="fc" id="L449">							fat_avg += rs.getInt(7);</span>
							//resultbuilder.append(rs.g(2));
						}
						
<span class="fc bfc" id="L453" title="All 2 branches covered.">						if (result_count&gt;0)</span>
						{
<span class="fc" id="L455">						weight_avg = weight_avg / result_count;</span>
<span class="fc" id="L456">						energy_avg = energy_avg / result_count;</span>
<span class="fc" id="L457">						sodium_avg = sodium_avg / result_count;</span>
<span class="fc" id="L458">						fat_avg = fat_avg / result_count;</span>
						
<span class="fc" id="L460">						weight_total += weight_avg;</span>
<span class="fc" id="L461">						energy_total += energy_avg;</span>
<span class="fc" id="L462">						sodium_total += sodium_avg;</span>
<span class="fc" id="L463">						fat_total += fat_avg;</span>
						
						//resultbuilder.append(ingredients[j] + &quot;: \n Average Weight = &quot; + weight_avg + &quot; (g) \n Average Energy = &quot; + energy_avg + &quot; (kcal) \n Average Sodium = &quot; + sodium_avg + &quot; (g) \n Saturated Fat = &quot; + fat_avg + &quot; (g) \n \n&quot;);
						}
<span class="fc" id="L467">						rs.close();</span>
<span class="fc" id="L468">						stmt.close();</span>
<span class="fc" id="L469">						connection.close();</span>
						}
<span class="fc" id="L471">						resultbuilder.append(dishes[i] + &quot;:\nWeight = &quot; + weight_total + &quot; (g)\nEnergy = &quot; + energy_total + &quot; (kcal)\nSodium = &quot; + sodium_total + &quot; (mg)\nFatty Acids = &quot; + fat_total + &quot; (g)&quot;);</span>
<span class="fc bfc" id="L472" title="All 2 branches covered.">						if(i!=(dishes.length-1)) {</span>
<span class="fc" id="L473">							resultbuilder.append(&quot;\n\n&quot;);</span>
						}
							
			}			
<span class="fc" id="L477">		}catch(Exception e){</span>
<span class="fc" id="L478">			System.out.println(e);</span>
<span class="fc" id="L479">		}</span>
<span class="fc" id="L480">		result_set = resultbuilder.toString();</span>
<span class="fc" id="L481">		return result_set;</span>
	}
	
	/**
	* This method is used to record nutrient info in our database for a particular user.
	* @param text This is the input passed by user which indicates what they ate.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the nutrient info of the meal and signals user if the intake is too high.
	* @exception IOException If input is invalid.
	* @exception SQLException If error in database.
	*/
	public String eat(String text, String userId) throws Exception {
		String result_set;
		String[] dishes;
<span class="fc" id="L495">		dishes = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L496">		StringBuilder resultbuilder = new StringBuilder();</span>
		try {	
<span class="fc" id="L498">			int eat_weight_total = 0;</span>
<span class="fc" id="L499">			int eat_energy_total = 0;</span>
<span class="fc" id="L500">			int eat_sodium_total = 0;</span>
<span class="fc" id="L501">			int eat_fat_total = 0;</span>
<span class="fc bfc" id="L502" title="All 2 branches covered.">			for(int i=1; i &lt; dishes.length;i++) {</span>
<span class="fc" id="L503">				String[] ingredients = {};</span>
<span class="fc" id="L504">				ingredients = dishes[i].split(&quot; &quot;);</span>
<span class="fc" id="L505">				int weight_total = 0;</span>
<span class="fc" id="L506">				int energy_total = 0;</span>
<span class="fc" id="L507">				int sodium_total = 0;</span>
<span class="fc" id="L508">				int fat_total = 0;</span>
<span class="fc bfc" id="L509" title="All 2 branches covered.">				for(int j=0; j &lt; ingredients.length; j++)</span>
				{
<span class="fc" id="L511">					int weight_avg = 0;</span>
<span class="fc" id="L512">					int energy_avg = 0;</span>
<span class="fc" id="L513">					int sodium_avg = 0;</span>
<span class="fc" id="L514">					int fat_avg = 0;</span>
<span class="fc" id="L515">					int result_count = 0;</span>
<span class="fc" id="L516">					Connection connection = getConnection();</span>
<span class="fc" id="L517">					PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM nutrient_table WHERE description like concat( ?, '%')&quot;);</span>
<span class="fc" id="L518">					stmt.setString(1, ingredients[j]);</span>
<span class="fc" id="L519">					ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L520" title="All 2 branches covered.">					while (rs.next()) {</span>
<span class="fc" id="L521">						result_count++;</span>
<span class="fc" id="L522">						weight_avg += rs.getInt(3);</span>
<span class="fc" id="L523">						energy_avg += rs.getInt(5);</span>
<span class="fc" id="L524">						sodium_avg += rs.getInt(6);</span>
<span class="fc" id="L525">						fat_avg += rs.getInt(7);</span>
						//resultbuilder.append(rs.g(2));
					}
					
<span class="fc bfc" id="L529" title="All 2 branches covered.">					if (result_count&gt;0)</span>
					{
<span class="fc" id="L531">						weight_avg = weight_avg / result_count;</span>
<span class="fc" id="L532">						energy_avg = energy_avg / result_count;</span>
<span class="fc" id="L533">						sodium_avg = sodium_avg / result_count;</span>
<span class="fc" id="L534">						fat_avg = fat_avg / result_count;</span>
						
<span class="fc" id="L536">						weight_total += weight_avg;</span>
<span class="fc" id="L537">						energy_total += energy_avg;</span>
<span class="fc" id="L538">						sodium_total += sodium_avg;</span>
<span class="fc" id="L539">						fat_total += fat_avg;</span>
						
<span class="fc" id="L541">						eat_weight_total += weight_avg;</span>
<span class="fc" id="L542">						eat_energy_total += energy_avg;</span>
<span class="fc" id="L543">						eat_sodium_total += sodium_avg;</span>
<span class="fc" id="L544">						eat_fat_total += fat_avg;</span>
						
						//resultbuilder.append(ingredients[j] + &quot;: \n Average Weight = &quot; + weight_avg + &quot; (g) \n Average Energy = &quot; + energy_avg + &quot; (kcal) \n Average Sodium = &quot; + sodium_avg + &quot; (g) \n Saturated Fat = &quot; + fat_avg + &quot; (g) \n \n&quot;);
					}
					
<span class="fc" id="L549">					rs.close();</span>
				}
<span class="fc" id="L551">				resultbuilder.append(dishes[i] + &quot;:\nWeight = &quot; + weight_total + &quot; (g)\nEnergy = &quot; + energy_total + &quot; (kcal)\nSodium = &quot; + sodium_total + &quot; (mg)\nFatty Acids = &quot; + fat_total + &quot; (g)\n\n&quot;);</span>
<span class="fc" id="L552">				result_set = resultbuilder.toString();</span>
				
			}
<span class="fc" id="L555">			boolean data_exists = false;</span>
<span class="fc" id="L556">			Connection connection = getConnection();</span>
<span class="fc" id="L557">			PreparedStatement stmt2 = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L558">			stmt2.setString(1, userId);</span>
<span class="fc" id="L559">			ResultSet rs2 = stmt2.executeQuery();</span>
<span class="fc bfc" id="L560" title="All 2 branches covered.">			if (rs2.next()) {</span>
<span class="fc" id="L561">				data_exists = true;</span>
			}
<span class="fc" id="L563">			rs2.close();</span>
<span class="fc bfc" id="L564" title="All 2 branches covered.">			if(data_exists){</span>
<span class="fc" id="L565">				System.out.println(&quot;Recording Data&quot;);</span>
<span class="fc" id="L566">				Calendar c = Calendar.getInstance();</span>
<span class="fc" id="L567">				int day_of_year = c.get(Calendar.DAY_OF_YEAR);</span>
<span class="fc" id="L568">				System.out.println(day_of_year);</span>
<span class="fc" id="L569">				int temp_day = 0;</span>
				
<span class="fc" id="L571">				PreparedStatement stmt3 = connection.prepareStatement(&quot;SELECT today FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L572">				stmt3.setString(1, userId);</span>
<span class="fc" id="L573">				ResultSet rs3 = stmt3.executeQuery();</span>
<span class="pc bpc" id="L574" title="1 of 2 branches missed.">				if (rs3.next()) {</span>
<span class="fc" id="L575">					temp_day = rs3.getInt(1);</span>
				}
				
<span class="fc" id="L578">				System.out.println(eat_energy_total);</span>
<span class="fc" id="L579">				System.out.println(eat_sodium_total);</span>
<span class="fc" id="L580">				System.out.println(eat_fat_total);</span>
				
<span class="pc bpc" id="L582" title="1 of 2 branches missed.">				if(day_of_year == temp_day) {</span>
<span class="fc" id="L583">					int day_of_week = c.get(Calendar.DAY_OF_WEEK);</span>
<span class="fc" id="L584">					System.out.println(&quot;Same day&quot;);</span>
<span class="fc" id="L585">					System.out.println(day_of_week);</span>
<span class="fc" id="L586">					PreparedStatement stmt4 = connection.prepareStatement(&quot;UPDATE user_info set energy_&quot; + day_of_week + &quot; = energy_&quot; + day_of_week + &quot; + ? where user_id = ?&quot;);</span>
<span class="fc" id="L587">					stmt4.setInt(1, eat_energy_total);</span>
<span class="fc" id="L588">					stmt4.setString(2, userId);</span>
<span class="fc" id="L589">					stmt4.executeUpdate();</span>
					
<span class="fc" id="L591">					PreparedStatement stmt5 = connection.prepareStatement(&quot;UPDATE user_info set sodium = sodium + ? where user_id = ?&quot;);</span>
<span class="fc" id="L592">					stmt5.setInt(1, eat_sodium_total);</span>
<span class="fc" id="L593">					stmt5.setString(2, userId);</span>
<span class="fc" id="L594">					stmt5.executeUpdate();</span>
					
<span class="fc" id="L596">					PreparedStatement stmt6 = connection.prepareStatement(&quot;UPDATE user_info set fatty_acid = fatty_acid + ? where user_id = ?&quot;);</span>
<span class="fc" id="L597">					stmt6.setInt(1, eat_fat_total);</span>
<span class="fc" id="L598">					stmt6.setString(2, userId);</span>
<span class="fc" id="L599">					stmt6.executeUpdate();</span>
<span class="fc" id="L600">				}else {</span>
<span class="nc" id="L601">					int day_of_week = c.get(Calendar.DAY_OF_WEEK);</span>
<span class="nc" id="L602">					System.out.println(&quot;New day&quot;);</span>
<span class="nc" id="L603">					System.out.println(day_of_week);</span>
<span class="nc" id="L604">					PreparedStatement stmt4 = connection.prepareStatement(&quot;UPDATE user_info set energy_&quot; + day_of_week + &quot; = ? where user_id = ?&quot;);</span>
<span class="nc" id="L605">					stmt4.setInt(1, eat_energy_total);</span>
<span class="nc" id="L606">					stmt4.setString(2, userId);</span>
<span class="nc" id="L607">					stmt4.executeUpdate();</span>
					
<span class="nc" id="L609">					PreparedStatement stmt5 = connection.prepareStatement(&quot;UPDATE user_info set sodium = ? where user_id = ?&quot;);</span>
<span class="nc" id="L610">					stmt5.setInt(1, eat_sodium_total);</span>
<span class="nc" id="L611">					stmt5.setString(2, userId);</span>
<span class="nc" id="L612">					stmt5.executeUpdate();</span>
					
<span class="nc" id="L614">					PreparedStatement stmt6 = connection.prepareStatement(&quot;UPDATE user_info set fatty_acid = ? where user_id = ?&quot;);</span>
<span class="nc" id="L615">					stmt6.setInt(1, eat_fat_total);</span>
<span class="nc" id="L616">					stmt6.setString(2, userId);</span>
<span class="nc" id="L617">					stmt6.executeUpdate();</span>
					
<span class="nc" id="L619">					PreparedStatement stmt7 = connection.prepareStatement(&quot;UPDATE user_info set today = ? where user_id = ?&quot;);</span>
<span class="nc" id="L620">					stmt7.setInt(1, day_of_year);</span>
<span class="nc" id="L621">					stmt7.setString(2, userId);</span>
<span class="nc" id="L622">					stmt7.executeUpdate();</span>
				}
			
				
<span class="fc" id="L626">				connection.close();</span>
<span class="fc" id="L627">				resultbuilder.append(&quot;Data is recorded!&quot;);</span>
			}
<span class="fc" id="L629">		}catch(Exception e){</span>
<span class="fc" id="L630">			System.out.println(e);</span>
<span class="fc" id="L631">		}</span>
<span class="fc" id="L632">		System.out.println(&quot;Call warning()&quot;);</span>
<span class="fc" id="L633">		String warning_message = warning(userId);</span>
<span class="fc" id="L634">		resultbuilder.append(warning_message);</span>
<span class="fc" id="L635">		System.out.println(warning_message);</span>
<span class="fc" id="L636">		result_set = resultbuilder.toString();</span>
<span class="fc" id="L637">		return result_set;</span>
	}
	
	/**
	* This method is used to determine whether the intake of a particular user is too high.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the warning message if the intake is too high.
	* @exception SQLException If error in database.
	*/
	public String warning(String userId) throws Exception{
		String result;
<span class="fc" id="L648">		StringBuilder resultbuilder = new StringBuilder();</span>
<span class="fc" id="L649">		double energy_requirement = 0;</span>
		
<span class="fc" id="L651">		int sodium = 0;</span>
<span class="fc" id="L652">		int fat = 0;</span>
<span class="fc" id="L653">		int total_energy = 0;</span>
<span class="fc" id="L654">		int energy_1 = 0;</span>
<span class="fc" id="L655">		int energy_2 = 0;</span>
<span class="fc" id="L656">		int energy_3 = 0;</span>
<span class="fc" id="L657">		int energy_4 = 0;</span>
<span class="fc" id="L658">		int energy_5 = 0;</span>
<span class="fc" id="L659">		int energy_6 = 0;</span>
<span class="fc" id="L660">		int energy_7 = 0;</span>
		
		String sex;
<span class="fc" id="L663">		int age = 0;</span>
<span class="fc" id="L664">		int weight = 0;</span>
<span class="fc" id="L665">		int height = 0;</span>
		
<span class="fc" id="L667">		Connection connection = getConnection();</span>
<span class="fc" id="L668">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT energy_1, energy_2, energy_3, energy_4, energy_5, energy_6, energy_7, sodium, fatty_acid, sex, age, weight, height FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L669">		stmt.setString(1, userId);</span>
<span class="fc" id="L670">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L671" title="All 2 branches covered.">		if(rs.next()) {</span>
<span class="fc" id="L672">			energy_1 = rs.getInt(1);</span>
<span class="fc" id="L673">			energy_2 = rs.getInt(2);</span>
<span class="fc" id="L674">			energy_3 = rs.getInt(3);</span>
<span class="fc" id="L675">			energy_4 = rs.getInt(4);</span>
<span class="fc" id="L676">			energy_5 = rs.getInt(5);</span>
<span class="fc" id="L677">			energy_6 = rs.getInt(6);</span>
<span class="fc" id="L678">			energy_7 = rs.getInt(7);</span>
<span class="fc" id="L679">			sodium = rs.getInt(8);</span>
<span class="fc" id="L680">			fat = rs.getInt(9);</span>
<span class="fc" id="L681">			sex = rs.getString(10);</span>
<span class="fc" id="L682">			age = rs.getInt(11);</span>
<span class="fc" id="L683">			weight = rs.getInt(12);</span>
<span class="fc" id="L684">			height = rs.getInt(13);</span>
<span class="fc" id="L685">			total_energy = energy_1 + energy_2 + energy_3 + energy_4 + energy_5 + energy_6 + energy_7;</span>
<span class="fc" id="L686">			System.out.println(total_energy);</span>
			
			
<span class="fc bfc" id="L689" title="All 2 branches covered.">			if(sex.equals(&quot;F&quot;)) {</span>
<span class="fc" id="L690">				energy_requirement = ((655 + (9.6 * weight) + (1.8 * height) - (4.7 * age)) * 10.85);</span>
<span class="fc" id="L691">				System.out.println(energy_requirement);</span>
<span class="fc bfc" id="L692" title="All 2 branches covered.">			}else if(sex.equals(&quot;M&quot;)) {</span>
<span class="fc" id="L693">				energy_requirement = ((66 + (13.7 * weight) + (5 * height) - (6.8 * age)) * 10.85);</span>
<span class="fc" id="L694">				System.out.println(energy_requirement);</span>
			}else {
<span class="fc" id="L696">				return &quot;\nUser info is invalid. Please use 'info' function again and ensure that all your info is properly set&quot;;</span>
			}
			
<span class="fc bfc" id="L699" title="All 2 branches covered.">			if(total_energy &gt;= energy_requirement) {</span>
<span class="fc" id="L700">				resultbuilder.append(&quot;\n\nWeekly Energy intake has EXCEED LIMIT!&quot;);</span>
			}
<span class="fc bfc" id="L702" title="All 2 branches covered.">			if(fat &gt;= 44) {</span>
<span class="fc" id="L703">				resultbuilder.append(&quot;\n\nDaily Fat intake has EXCEED LIMIT!&quot;);</span>
			}
<span class="fc bfc" id="L705" title="All 2 branches covered.">			if(sodium &gt;= 3000) {</span>
<span class="fc" id="L706">				resultbuilder.append(&quot;\n\nDaily Sodium intake has EXCEED LIMIT!&quot;);</span>
			}
		}
		else
		{
<span class="fc" id="L711">			resultbuilder.append(&quot;Error&quot;);</span>
		}
		
<span class="fc" id="L714">		result = resultbuilder.toString();</span>
<span class="fc" id="L715">		return result;</span>
	}
	
	/**
	* This method is used to calculate time required to burn calories for a particular user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the time required for different sports intensity.
	* @exception SQLException If error in database.
	*/
	public String sports_amount(String userId) throws Exception {
		//Write your code here
<span class="fc" id="L726">		String result = null;</span>
<span class="fc" id="L727">		float weight = 0;</span>
<span class="fc" id="L728">		int energy = 0;</span>
<span class="fc" id="L729">		int light_multiplier = 1;</span>
<span class="fc" id="L730">		int medium_multiplier = 4;</span>
<span class="fc" id="L731">		int heavy_multiplier = 8;</span>
<span class="fc" id="L732">		Connection connection = getConnection();</span>
<span class="fc" id="L733">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L734">		stmt.setString(1, userId);</span>
<span class="fc" id="L735">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L736" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L737">			weight = rs.getInt(2);</span>
<span class="fc" id="L738">			energy = rs.getInt(3) + rs.getInt(4) + rs.getInt(5) + rs.getInt(6) + rs.getInt(7) + rs.getInt(8) + rs.getInt(9); 			</span>
		}
<span class="fc" id="L740">		rs.close();</span>
<span class="fc bfc" id="L741" title="All 2 branches covered.">		if(weight&gt;0)</span>
		{
<span class="fc" id="L743">			result = &quot;Total energy intake(for the last 7 days) is : &quot; + energy + &quot; kcal.\nyour weight is : &quot; + weight + &quot;kg.\n\nTime required to consume:\nLight(e.g. walking) : &quot; + energy/(weight*light_multiplier) + &quot; hr\nMedium(e.g. jogging) : &quot; + energy/(weight*medium_multiplier) + &quot; hr\nHeavy(e.g. running, swimming) : &quot; + energy/(weight*heavy_multiplier) + &quot; hr\n&quot;  ;</span>
<span class="fc" id="L744">			return result;</span>
		}
		else
		{
<span class="fc" id="L748">			result = &quot;Your Weight is invalid! Please set your weight first&quot;;</span>
<span class="fc" id="L749">			return result;</span>
		}

	}
	
	/**
	* This method is used to manually input energy taken on a day for a particular user.
	* @param text This is the input passed by user which indicates energy the took.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns whether the info is recorded to database successfully.
	* @exception IOException If input is invalid (e.g. not entering number).
	* @exception SQLException If error in database.
	*/ 
	public String energy(String text, String userId) throws Exception {
		//Write your code here
<span class="fc" id="L764">		String result = null;</span>
<span class="fc" id="L765">		String[] items = new String[4];</span>
<span class="fc" id="L766">		int weekday_time = 0;</span>
<span class="fc" id="L767">		items = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L768">		boolean data_exists = false;</span>
<span class="fc" id="L769">		int energy = Integer.parseInt(items[1]);</span>
<span class="fc" id="L770">		System.out.println(&quot;Test:Set energy&quot;);</span>
<span class="fc" id="L771">		System.out.println(items[2]);</span>
<span class="fc" id="L772">		String week_day = items[2].toLowerCase();</span>
<span class="pc bpc" id="L773" title="7 of 30 branches missed.">		switch(week_day) {</span>
			case &quot;sun&quot;:{
<span class="fc" id="L775">				weekday_time = 1;</span>
<span class="fc" id="L776">				break;</span>
			}
			case &quot;mon&quot;:{
<span class="fc" id="L779">				weekday_time = 2;</span>
<span class="fc" id="L780">				break;</span>
			}
			case &quot;tue&quot;:{
<span class="fc" id="L783">				weekday_time = 3;</span>
<span class="fc" id="L784">				break;</span>
			}
			case &quot;wed&quot;:{
<span class="fc" id="L787">				weekday_time = 4;</span>
<span class="fc" id="L788">				break;</span>
			}
			case &quot;thu&quot;:{
<span class="fc" id="L791">				weekday_time = 5;</span>
<span class="fc" id="L792">				break;</span>
			}
			case &quot;fri&quot;:{
<span class="fc" id="L795">				weekday_time = 6;</span>
<span class="fc" id="L796">				break;</span>
			}
			case &quot;sat&quot;:{
<span class="fc" id="L799">				weekday_time = 7;</span>
<span class="fc" id="L800">				break;</span>
			}
			default:{
<span class="fc" id="L803">				Calendar c = Calendar.getInstance();</span>
				//Date d = c.getTime();
				//c.setTime(d);
<span class="fc" id="L806">				weekday_time = c.get(Calendar.DAY_OF_WEEK);</span>
<span class="fc" id="L807">				System.out.println(&quot;Test: &quot; + weekday_time);</span>
			}
		}
<span class="fc" id="L810">		System.out.println(weekday_time);</span>
<span class="fc" id="L811">		System.out.println(userId);</span>
		
<span class="fc" id="L813">		Connection connection = getConnection();</span>
<span class="fc" id="L814">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT * FROM user_info WHERE user_id = ?&quot;);</span>
<span class="fc" id="L815">		stmt.setString(1, userId);</span>
<span class="fc" id="L816">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L817" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L818">			data_exists = true;</span>
<span class="fc" id="L819">			System.out.println(&quot;Test: User ID Exist&quot;);</span>
		}else {
<span class="fc" id="L821">			System.out.println(&quot;Test: User ID not Exist&quot;);</span>
		}
<span class="fc" id="L823">		rs.close();</span>
<span class="fc bfc" id="L824" title="All 2 branches covered.">		if(data_exists)</span>
		{
<span class="fc" id="L826">			String sql = &quot;UPDATE user_info set energy_&quot; + weekday_time + &quot; = ? where user_id = ?&quot;;</span>
			PreparedStatement stmt2;
<span class="fc" id="L828">			stmt2 = connection.prepareStatement(sql);</span>
<span class="fc" id="L829">			stmt2.setInt(1, energy);</span>
<span class="fc" id="L830">			stmt2.setString(2, userId);</span>
<span class="fc" id="L831">			stmt2.executeUpdate();</span>
<span class="fc" id="L832">			connection.close();</span>
<span class="fc" id="L833">			result = &quot;Data updated!&quot;;</span>
<span class="fc" id="L834">			return result;</span>
		}
		else
		{
<span class="fc" id="L838">			return result;</span>
		}

	}
	
	/**
	* This method is used to obtain the unique 6-digit code for a particular user.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns the code of the user.
	* @exception SQLException If error in database.
	*/
	public String friend(String userId) throws Exception {
		//Write your code here
<span class="fc" id="L851">		String result = null;</span>
<span class="fc" id="L852">		int user_id = 0;</span>
		
<span class="fc" id="L854">		boolean data_exists = false;</span>
		
<span class="fc" id="L856">		Connection connection = getConnection();</span>
<span class="fc" id="L857">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT user_number from coupontable where user_id = ?&quot;);</span>
<span class="fc" id="L858">		stmt.setString(1, userId);</span>
<span class="fc" id="L859">		ResultSet rs = stmt.executeQuery();</span>
		
<span class="fc bfc" id="L861" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L862">			user_id = rs.getInt(1);</span>
<span class="fc" id="L863">			result = Integer.toString(user_id);</span>
<span class="fc bfc" id="L864" title="All 2 branches covered.">			for(int i = result.length(); i &lt; 6; i++) {</span>
<span class="fc" id="L865">				result = &quot;0&quot; + result;</span>
			}
<span class="fc" id="L867">			connection.close();</span>
<span class="fc" id="L868">			return result;</span>
		}else {
<span class="fc" id="L870">			result = &quot;You are not qualified for this event! This event is only for new users.&quot;;</span>
<span class="fc" id="L871">			connection.close();</span>
<span class="fc" id="L872">			return result;</span>
		}
	}
	
	/**
	* This method is used when user refer their friends by entering their code.
	* @param text This is the input passed by user which indicates the user that invited them.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns if the referral is valid and if coupon has been given to them.
	* @exception IOException If input is invalid (i.e. not entering a number).
	* @exception SQLException If error in database.
	*/
	public String code(String text, String userId) throws Exception {
		
<span class="fc" id="L886">		String result = null;</span>
		String[] items;
<span class="fc" id="L888">		items = text.split(&quot;\\r?\\n&quot;);</span>
<span class="fc" id="L889">		int user_id = Integer.parseInt(items[1]);</span>
<span class="fc bfc" id="L890" title="All 2 branches covered.">		if(items[1].length()!=6)</span>
		{
<span class="fc" id="L892">			result = &quot;Don't miss the zero(s)! Please try again.&quot;;</span>
<span class="fc" id="L893">			return result;</span>
		}
		
<span class="fc" id="L896">		boolean data_exists = false;</span>
<span class="fc" id="L897">		boolean code = true;</span>
<span class="fc" id="L898">		int coupon_count = 0;</span>
		
<span class="fc" id="L900">		Connection connection = getConnection();</span>
		
<span class="fc" id="L902">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT user_number FROM coupontable where user_id = ?&quot;);</span>
<span class="fc" id="L903">		stmt.setString(1, userId);</span>
<span class="fc" id="L904">		ResultSet check_your_id = stmt.executeQuery();</span>
<span class="fc bfc" id="L905" title="All 2 branches covered.">		if(check_your_id.next())</span>
		{
<span class="fc bfc" id="L907" title="All 2 branches covered.">			if (check_your_id.getInt(1) == user_id)</span>
			{
<span class="fc" id="L909">				result = &quot;Hey! You can not refer yourself!&quot;;</span>
<span class="fc" id="L910">				return result;</span>
			}
		}
		
<span class="fc" id="L914">		PreparedStatement stmt1 = connection.prepareStatement(&quot;SELECT * FROM coupontable where user_number = ? and user_id not like 'master'&quot;);</span>
<span class="fc" id="L915">		stmt1.setInt(1, user_id);</span>
<span class="fc" id="L916">		ResultSet rs = stmt1.executeQuery();</span>
<span class="fc bfc" id="L917" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L918">			data_exists = true;</span>
		}
<span class="fc" id="L920">		PreparedStatement stmt2 = connection.prepareStatement(&quot;SELECT code FROM coupontable where user_id = ?&quot;);</span>
<span class="fc" id="L921">		stmt2.setString(1, userId);</span>
<span class="fc" id="L922">		ResultSet rs2 = stmt2.executeQuery();</span>
<span class="fc bfc" id="L923" title="All 2 branches covered.">		if (rs2.next()) {</span>
<span class="fc" id="L924">			code = rs2.getBoolean(1);</span>
<span class="fc" id="L925">			System.out.println(&quot;code false&quot;);</span>
		}
<span class="fc" id="L927">		PreparedStatement stmt7 = connection.prepareStatement(&quot;SELECT coupon_count FROM coupontable where user_id = 'master'&quot;);</span>
<span class="fc" id="L928">		ResultSet rs3 = stmt7.executeQuery();</span>
<span class="pc bpc" id="L929" title="1 of 2 branches missed.">		if (rs3.next()) {</span>
<span class="fc" id="L930">			coupon_count = rs3.getInt(1);</span>
		}
		
<span class="pc bpc" id="L933" title="1 of 6 branches missed.">		if(!code &amp;&amp; data_exists &amp;&amp; coupon_count &lt; 5000) {</span>
<span class="fc" id="L934">			System.out.println(&quot;Updating&quot;);</span>
<span class="fc" id="L935">			PreparedStatement stmt3 = connection.prepareStatement(&quot;UPDATE coupontable set code = true where user_id = ?&quot;);</span>
<span class="fc" id="L936">			stmt3.setString(1, userId);</span>
<span class="fc" id="L937">			stmt3.executeUpdate();</span>
			
<span class="fc" id="L939">			PreparedStatement stmt4 = connection.prepareStatement(&quot;UPDATE coupontable set coupon_count = coupon_count + 1 where user_id = ?&quot;);</span>
<span class="fc" id="L940">			stmt4.setString(1, userId);</span>
<span class="fc" id="L941">			stmt4.executeUpdate();</span>
			
<span class="fc" id="L943">			PreparedStatement stmt5 = connection.prepareStatement(&quot;UPDATE coupontable set coupon_count = coupon_count + 1 where user_number = ? and user_id not like 'master'&quot;);</span>
<span class="fc" id="L944">			stmt5.setInt(1, user_id);</span>
<span class="fc" id="L945">			stmt5.executeUpdate();</span>
			
<span class="fc" id="L947">			PreparedStatement stmt6 = connection.prepareStatement(&quot;UPDATE coupontable set coupon_count = coupon_count + 2 where user_id = 'master'&quot;);</span>
<span class="fc" id="L948">			stmt6.executeUpdate();</span>
		
<span class="fc" id="L950">			result = &quot;Both you and your friend has got a coupon! You may redeem it using 'redeem'.&quot;;</span>
<span class="fc" id="L951">			connection.close();</span>
<span class="fc" id="L952">			return result;</span>
<span class="fc bfc" id="L953" title="All 2 branches covered.">		}else if(!data_exists){</span>
<span class="fc" id="L954">			result = &quot;There is no user associated with the code! Please ask your friend and get the correct one.&quot;;</span>
<span class="fc" id="L955">			connection.close();</span>
<span class="fc" id="L956">			return result;</span>
<span class="fc bfc" id="L957" title="All 2 branches covered.">		}else if(coupon_count &gt;= 5000){</span>
<span class="fc" id="L958">			result = &quot;Sorry, the event has ended and all the coupons has been given out.&quot;;</span>
<span class="fc" id="L959">			connection.close();</span>
<span class="fc" id="L960">			return result;</span>
		}else{
<span class="fc" id="L962">			result = &quot;You are not qualified for this event! Either you are not a new user or you have already referred your friend.&quot;;</span>
<span class="fc" id="L963">			connection.close();</span>
<span class="fc" id="L964">			return result;</span>
		}
	}
	
	/**
	* This method is used when user try to redeem a coupon.
	* @param userId This is the unique user ID generated by Line.
	* @return String This returns if the redeem is good and if they still have any coupons left.
	* @exception SQLException If error in database.
	*/
	public String redeem(String userId) throws Exception {
		//Write your code here
<span class="fc" id="L976">		String result = null;</span>
<span class="fc" id="L977">		int coupon_count = 0;</span>
<span class="fc" id="L978">		boolean data_exists = false;</span>
		
<span class="fc" id="L980">		Connection connection = getConnection();</span>
<span class="fc" id="L981">		PreparedStatement stmt = connection.prepareStatement(&quot;SELECT coupon_count FROM coupontable where user_id = ?&quot;);</span>
<span class="fc" id="L982">		stmt.setString(1, userId);</span>
<span class="fc" id="L983">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L984" title="All 2 branches covered.">		if (rs.next()) {</span>
<span class="fc" id="L985">			coupon_count = rs.getInt(1);</span>
		}
<span class="fc bfc" id="L987" title="All 2 branches covered.">		if(coupon_count &gt; 0) {</span>
<span class="fc" id="L988">			PreparedStatement stmt2 = connection.prepareStatement(&quot;UPDATE coupontable set coupon_count = coupon_count - 1 where user_id = ?&quot;);</span>
<span class="fc" id="L989">			stmt2.setString(1, userId);</span>
<span class="fc" id="L990">			stmt2.executeUpdate();</span>
<span class="fc" id="L991">			result = &quot;You redeemed one coupon\nYou still have &quot; + --coupon_count + &quot; coupon(s) to be redeemed.&quot;;</span>
<span class="fc" id="L992">			connection.close();</span>
<span class="fc" id="L993">			return result;</span>
		}else {
<span class="fc" id="L995">			result = &quot;You currently have no coupon&quot;;</span>
<span class="fc" id="L996">			connection.close();</span>
<span class="fc" id="L997">			return result;</span>
		}
		
	}
	/**
	* This method is used to initialize test data.
	* @param sqlstatement This is the SQL Statement passed to guranteen test data is in good condition.
	* @exception SQLException If error in database.
	*/
	public void InitiallizeTestData(String sqlstatement) throws Exception {
<span class="fc" id="L1007">		Connection connection = getConnection();</span>
<span class="fc" id="L1008">		PreparedStatement stmt = connection.prepareStatement(sqlstatement);</span>
<span class="fc" id="L1009">		stmt.executeUpdate();</span>
<span class="fc" id="L1010">		connection.close();	</span>
<span class="fc" id="L1011">	}</span>
	
	/**
	* This method is used to get the current total coupon number for a testcase.
	* This is specifically needed for testing if the handling is correct when coupon is greater than 5000.
	* The value will be saved by a variable and set the value again when the testcase is finished.
	* @param sqlstatement This is the SQL Statement passed to guranteen test data is in good condition.
	* @return the current total number of coupon given out
	* @exception SQLException If error in database.
	*/
	public int GetCouponCount(String sqlstatement) throws Exception {
<span class="fc" id="L1022">		int result = 0;</span>
<span class="fc" id="L1023">		Connection connection = getConnection();</span>
<span class="fc" id="L1024">		PreparedStatement stmt = connection.prepareStatement(sqlstatement);</span>
<span class="fc" id="L1025">		ResultSet rs = stmt.executeQuery();</span>
<span class="fc bfc" id="L1026" title="All 2 branches covered.">		if(rs.next())</span>
		{
<span class="fc" id="L1028">			result = rs.getInt(1);</span>
<span class="fc" id="L1029">			connection.close();</span>
<span class="fc" id="L1030">			return result;</span>
		}
<span class="fc" id="L1032">		connection.close();</span>
<span class="fc" id="L1033">		return result;</span>
	}
	
	/**
	* This method is used to give recommendation for user.
	* Recommendation includes meal time and meal type.
	* @param userID This is the user ID for the user generated by Line.
	* @param decision A number which decides which option.
	* @return String This returns the next steps/result of the feature.
	* @exception IOException If input is invalid.
	* @exception SQLException If error in database.
	*/
	public String order(String userID, String decision) throws Exception {	
					
			try {
<span class="fc" id="L1048">			Connection connection = getConnection();</span>
			//find state
<span class="fc" id="L1050">			PreparedStatement find_state = connection.prepareStatement(&quot;SELECT state FROM user_info where user_id = ?&quot;);</span>
<span class="fc" id="L1051">			find_state.setString(1, userID);</span>
<span class="fc" id="L1052">			ResultSet find_state1=find_state.executeQuery();</span>
<span class="fc" id="L1053">			find_state1.next();</span>
<span class="fc" id="L1054">			int state=find_state1.getInt(1);</span>
<span class="fc" id="L1055">			find_state1.close();</span>
<span class="fc" id="L1056">			find_state.close();</span>
			
			
<span class="fc bfc" id="L1059" title="All 7 branches covered.">			switch (state) { //change state</span>
			case 0:
			{
<span class="fc" id="L1062">				state=1;</span>
<span class="fc" id="L1063">			break;}</span>
			

			
			case 1: //meal menu
<span class="fc bfc" id="L1068" title="All 2 branches covered.">				{if (decision.toLowerCase().equals(&quot;exit&quot;)) state=1;</span>
<span class="fc bfc" id="L1069" title="All 2 branches covered.">				else if (decision.equals(&quot;1&quot;)) {</span>
					
<span class="fc" id="L1071">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_meal_time= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1072">				change_choice.setString(1, &quot;breakfast&quot;);</span>
<span class="fc" id="L1073">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1074">				change_choice.executeUpdate();</span>
<span class="fc" id="L1075">				change_choice.close();		</span>
<span class="fc" id="L1076">				state=11;}</span>
				
<span class="fc bfc" id="L1078" title="All 2 branches covered.">				else if (decision.equals(&quot;2&quot;))  {</span>
					
<span class="fc" id="L1080">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_meal_time= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1081">				change_choice.setString(1, &quot;lunch&quot;);</span>
<span class="fc" id="L1082">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1083">				change_choice.executeUpdate();</span>
<span class="fc" id="L1084">				change_choice.close();		</span>
<span class="fc" id="L1085">				state=11;}</span>
<span class="fc bfc" id="L1086" title="All 2 branches covered.">				else if (decision.equals(&quot;3&quot;))  {</span>
					
<span class="fc" id="L1088">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_meal_time= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1089">				change_choice.setString(1, &quot;dinner&quot;);</span>
<span class="fc" id="L1090">				change_choice.setString(2, userID);			</span>
<span class="fc" id="L1091">				change_choice.executeUpdate();</span>
<span class="fc" id="L1092">				change_choice.close();		</span>
<span class="fc" id="L1093">				state=11;}</span>
<span class="fc bfc" id="L1094" title="All 2 branches covered.">				else if (decision.equals(&quot;4&quot;))  {</span>
					
<span class="fc" id="L1096">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_meal_time= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1097">				change_choice.setString(1, &quot;dessert&quot;);</span>
<span class="fc" id="L1098">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1099">				change_choice.executeUpdate();</span>
<span class="fc" id="L1100">				change_choice.close();		</span>
<span class="fc" id="L1101">				state=12;}</span>
			break;}
			
			case 11:
<span class="fc bfc" id="L1105" title="All 2 branches covered.">				{if (decision.toLowerCase().equals(&quot;exit&quot;)) state=1;</span>
<span class="fc bfc" id="L1106" title="All 2 branches covered.">				else if (decision.equals(&quot;1&quot;))  {</span>
<span class="fc" id="L1107">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1108">				change_choice.setString(1, &quot;vegetarian&quot;);</span>
<span class="fc" id="L1109">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1110">				change_choice.executeUpdate();</span>
<span class="fc" id="L1111">				change_choice.close();		</span>
<span class="fc" id="L1112">				state=111;}</span>
				
<span class="fc bfc" id="L1114" title="All 2 branches covered.">				else if (decision.equals(&quot;2&quot;)) {</span>
					
<span class="fc" id="L1116">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1117">				change_choice.setString(1, &quot;chicken&quot;);</span>
<span class="fc" id="L1118">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1119">				change_choice.executeUpdate();</span>
<span class="fc" id="L1120">				change_choice.close();		</span>
<span class="fc" id="L1121">				state=111;}</span>
<span class="fc bfc" id="L1122" title="All 2 branches covered.">				else if (decision.equals(&quot;3&quot;))  {</span>
					
<span class="fc" id="L1124">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1125">				change_choice.setString(1, &quot;pork&quot;);</span>
<span class="fc" id="L1126">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1127">				change_choice.executeUpdate();</span>
<span class="fc" id="L1128">				change_choice.close();		</span>
<span class="fc" id="L1129">				state=111;}</span>
				
<span class="fc bfc" id="L1131" title="All 2 branches covered.">				else if (decision.equals(&quot;4&quot;)) {</span>
					
<span class="fc" id="L1133">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1134">				change_choice.setString(1, &quot;beef&quot;);</span>
<span class="fc" id="L1135">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1136">				change_choice.executeUpdate();</span>
<span class="fc" id="L1137">				change_choice.close();		</span>
<span class="fc" id="L1138">				state=111;}</span>
				
<span class="fc bfc" id="L1140" title="All 2 branches covered.">				else if (decision.equals(&quot;5&quot;)) {</span>
					
<span class="fc" id="L1142">				PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1143">				change_choice.setString(1, &quot;nothing&quot;);</span>
<span class="fc" id="L1144">				change_choice.setString(2, userID);</span>
<span class="fc" id="L1145">				change_choice.executeUpdate();</span>
<span class="fc" id="L1146">				change_choice.close();		</span>
<span class="fc" id="L1147">				state=111;}</span>
				
				break;	}
				
			case 12:
<span class="fc bfc" id="L1152" title="All 2 branches covered.">				{if (decision.toLowerCase().equals(&quot;exit&quot;)) state=1;</span>
<span class="fc bfc" id="L1153" title="All 2 branches covered.">				else if (decision.equals(&quot;1&quot;))  {</span>
<span class="fc" id="L1154">					PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1155">					change_choice.setString(1, &quot;vegetarian&quot;);</span>
<span class="fc" id="L1156">					change_choice.setString(2, userID);</span>
<span class="fc" id="L1157">					change_choice.executeUpdate();</span>
<span class="fc" id="L1158">					change_choice.close();		</span>
<span class="fc" id="L1159">					state=112;}</span>
					
<span class="fc bfc" id="L1161" title="All 2 branches covered.">				else if (decision.equals(&quot;2&quot;)) {</span>
<span class="fc" id="L1162">					PreparedStatement change_choice = connection.prepareStatement(&quot;UPDATE user_info SET choose_type= ? where (user_id= ?);&quot;);</span>
<span class="fc" id="L1163">					change_choice.setString(1, &quot;nothing&quot;);</span>
<span class="fc" id="L1164">					change_choice.setString(2, userID);</span>
<span class="fc" id="L1165">					change_choice.executeUpdate();</span>
<span class="fc" id="L1166">					change_choice.close();		</span>
<span class="fc" id="L1167">					state=112;}</span>
				break;
				}
				
			case 111: //choose dishes function	
<span class="fc" id="L1172">				{state=1;</span>
<span class="fc" id="L1173">				break;}</span>
			case 112: //choose dessert function
<span class="fc" id="L1175">				{state=1;</span>
<span class="fc" id="L1176">				break;}</span>
				


			default:{
<span class="pc bpc" id="L1181" title="1 of 2 branches missed.">				if (decision.toLowerCase().equals(&quot;exit&quot;)) state=1;</span>
				break;
			}
			}
			
			

			
			
			//update state to user_info
<span class="fc" id="L1191">			String change_state_statement=&quot;UPDATE user_info SET state=&quot;+Integer.toString(state)+&quot; where user_id= '&quot;+userID+&quot;';&quot;;</span>
<span class="fc" id="L1192">			PreparedStatement change_state = connection.prepareStatement(change_state_statement);</span>
<span class="fc" id="L1193">			change_state.executeUpdate();</span>
<span class="fc" id="L1194">			change_state.close();</span>


			
<span class="fc" id="L1198">			String print_message=&quot;&quot;;</span>
			
<span class="fc bfc" id="L1200" title="All 6 branches covered.">			switch (state) { //ouput message</span>
	        //features menu
			case 1: //meal menu, feature 1,4,8,9,10
<span class="fc" id="L1203">			{print_message= &quot;Meal menu&quot;</span>
<span class="fc" id="L1204">					+ &quot;\n1.Breakfast \n2.Lunch \n3.Dinner \n4.Dessert\n&quot;; break;}</span>
			
<span class="fc" id="L1206">			case 11:{print_message= &quot;What type of food do you like to choose?\n1.Vegetarian\n2.Chicken\n3.Pork\n4.Beef\n5.Don't care&quot;;	break;}	</span>
<span class="fc" id="L1207">			case 12: {print_message= &quot;Are you vegetarian?\n1.yes\n2.no&quot;; break;}</span>
				
			case 111:{ //print dishes
<span class="fc" id="L1210">				PreparedStatement get_users_final_choice = connection.prepareStatement(&quot;SELECT * FROM user_info where (user_id= ?);&quot;);</span>
<span class="fc" id="L1211">				get_users_final_choice.setString(1, userID);</span>


<span class="fc" id="L1214">				ResultSet get_users_final_choice1=get_users_final_choice.executeQuery();</span>

<span class="pc bpc" id="L1216" title="1 of 2 branches missed.">				if (get_users_final_choice1.next()){</span>
<span class="fc" id="L1217">				String users_final_time=get_users_final_choice1.getString(15);		</span>
<span class="fc" id="L1218">				String users_final_type=get_users_final_choice1.getString(16);</span>

<span class="fc" id="L1220">				get_users_final_choice1.close();</span>
<span class="fc" id="L1221">				get_users_final_choice.close();</span>
<span class="fc" id="L1222">				String statement=&quot;&quot;;</span>
<span class="fc" id="L1223">				List&lt;Integer&gt; price = new ArrayList&lt;Integer&gt;();</span>
<span class="fc" id="L1224">				List&lt;String&gt; menu_name = new ArrayList&lt;String&gt;();</span>
				
<span class="fc" id="L1226">				PreparedStatement  get_dishes=null;</span>
<span class="fc bfc" id="L1227" title="All 2 branches covered.">				if (users_final_type.equals(&quot;nothing&quot;)){</span>
					
<span class="fc" id="L1229">					get_dishes = connection.prepareStatement(&quot;SELECT * FROM meal_menu where (meal_time= ? ) ;&quot;);</span>
<span class="fc" id="L1230">					get_dishes.setString(1,users_final_time);</span>
					//statement=&quot;SELECT * FROM meal_menu where ((choose_meal_time='&quot;+users_final_time+&quot;') and (username='test'));&quot;;
				}
				
				else {
<span class="fc" id="L1235">					get_dishes = connection.prepareStatement(&quot;SELECT * FROM meal_menu where ((meal_time= ? ) and (type= ? ));&quot;);</span>
<span class="fc" id="L1236">					get_dishes.setString(1,users_final_time);</span>
<span class="fc" id="L1237">					get_dishes.setString(2,users_final_type);</span>
					//statement=&quot;SELECT * FROM meal_menu where ((choose_meal_time='&quot;+users_final_time+&quot;') and (choose_type='&quot;+users_final_type+&quot;') and (username='test'));&quot;;
				}

				
		//		PreparedStatement get_dishes = connection.prepareStatement(statement);
<span class="fc" id="L1243">				ResultSet get_dishes1=get_dishes.executeQuery();</span>
<span class="fc" id="L1244">				int count_dishes=0;</span>
				
				
//				System.out.println(&quot;HELLO&quot;);
<span class="fc bfc" id="L1248" title="All 2 branches covered.">				while (get_dishes1.next()){</span>
<span class="fc" id="L1249">					price.add(get_dishes1.getInt(3));</span>
<span class="fc" id="L1250">					menu_name.add(get_dishes1.getString(1));				</span>
//					print_message=print_message+count_dishes+&quot;.&quot;+get_dishes1.getString(1)+&quot; &quot;+get_dishes1.getInt(3)+&quot;\n&quot;;	
<span class="fc" id="L1252">					count_dishes++;</span>
				}
				
				
<span class="fc" id="L1256">				int second_choice_index=0;</span>
<span class="fc" id="L1257">				int third_choice_index=0;</span>
<span class="fc" id="L1258">				int first_choice_index=0;</span>
				
				while (true){
<span class="fc" id="L1261">					first_choice_index=new Random().nextInt(count_dishes);</span>
<span class="fc bfc" id="L1262" title="All 2 branches covered.">					if(menu_name.get(first_choice_index).startsWith(&quot;*&quot;))</span>
					{
<span class="fc" id="L1264">					break;</span>
					}
				}
				


				while (true){
<span class="fc" id="L1271">					second_choice_index=new Random().nextInt(count_dishes);</span>
<span class="fc bfc" id="L1272" title="All 2 branches covered.">					if (second_choice_index!=first_choice_index)</span>
					{
<span class="fc" id="L1274">						break;	</span>
					}
				}


				while (true){
<span class="fc" id="L1280">					third_choice_index=new Random().nextInt(count_dishes);</span>
<span class="fc bfc" id="L1281" title="All 4 branches covered.">					if ((third_choice_index!=first_choice_index) &amp;&amp; third_choice_index!=second_choice_index)</span>
					{
<span class="fc" id="L1283">						break;	</span>
					}
				}
<span class="fc" id="L1286">				System.out.println(third_choice_index);</span>
				
<span class="fc" id="L1288">				print_message=&quot;1.&quot;+menu_name.get(first_choice_index)+&quot; &quot;+price.get(first_choice_index)+&quot;\n&quot;;</span>
<span class="fc" id="L1289">				print_message=print_message+&quot;2.&quot;+menu_name.get(second_choice_index)+&quot; &quot;+price.get(second_choice_index)+&quot;\n&quot;;</span>
<span class="fc" id="L1290">				print_message=print_message+&quot;3.&quot;+menu_name.get(third_choice_index)+&quot; &quot;+price.get(third_choice_index)+&quot;\n&quot;;</span>
<span class="fc" id="L1291">				print_message=print_message+&quot;* means that the meal is commonly eaten at restaurants\n&quot;;</span>
				
				
<span class="fc" id="L1294">				break;</span>
			}
			break;
			} 
			case 112: { //print dishes
<span class="fc" id="L1299">				PreparedStatement get_users_final_choice = connection.prepareStatement(&quot;SELECT * FROM user_info where (user_id= ?);&quot;);</span>
<span class="fc" id="L1300">				get_users_final_choice.setString(1, userID);</span>


<span class="fc" id="L1303">				ResultSet get_users_final_choice1=get_users_final_choice.executeQuery();</span>

<span class="pc bpc" id="L1305" title="1 of 2 branches missed.">				if (get_users_final_choice1.next()){</span>
<span class="fc" id="L1306">				String users_final_time=get_users_final_choice1.getString(15);		</span>
<span class="fc" id="L1307">				String users_final_type=get_users_final_choice1.getString(16);</span>

<span class="fc" id="L1309">				get_users_final_choice1.close();</span>
<span class="fc" id="L1310">				get_users_final_choice.close();</span>
<span class="fc" id="L1311">				String statement=&quot;&quot;;</span>
<span class="fc" id="L1312">				List&lt;Integer&gt; price = new ArrayList&lt;Integer&gt;();</span>
<span class="fc" id="L1313">				List&lt;String&gt; menu_name = new ArrayList&lt;String&gt;();</span>
				

<span class="fc bfc" id="L1316" title="All 2 branches covered.">				if (users_final_type.equals(&quot;nothing&quot;)){</span>
					
<span class="fc" id="L1318">					statement=&quot;SELECT * FROM meal_menu where ((meal_time='dessert'));&quot;;			}</span>
				
				else {
<span class="fc" id="L1321">					statement=&quot;SELECT * FROM meal_menu where ((meal_time='dessert') and (type='vegetarian'));&quot;;	</span>
				}

				
<span class="fc" id="L1325">				PreparedStatement get_dishes = connection.prepareStatement(statement);</span>
<span class="fc" id="L1326">				ResultSet get_dishes1=get_dishes.executeQuery();</span>
<span class="fc" id="L1327">				int count_dishes=0;</span>
				
				
//				System.out.println(&quot;HELLO&quot;);
<span class="fc bfc" id="L1331" title="All 2 branches covered.">				while (get_dishes1.next()){</span>
<span class="fc" id="L1332">					price.add(get_dishes1.getInt(3));</span>
<span class="fc" id="L1333">					menu_name.add(get_dishes1.getString(1));				</span>
//					print_message=print_message+count_dishes+&quot;.&quot;+get_dishes1.getString(1)+&quot; &quot;+get_dishes1.getInt(3)+&quot;\n&quot;;	
<span class="fc" id="L1335">					count_dishes++;</span>
				}
				
				
<span class="fc" id="L1339">				int second_choice_index=0;</span>
<span class="fc" id="L1340">				int third_choice_index=0;</span>
<span class="fc" id="L1341">				int first_choice_index=0;</span>
				
				while (true){
<span class="fc" id="L1344">					first_choice_index=new Random().nextInt(count_dishes);</span>
<span class="fc bfc" id="L1345" title="All 2 branches covered.">					if(menu_name.get(first_choice_index).startsWith(&quot;*&quot;)) {</span>
<span class="fc" id="L1346">					break;</span>
					}
				}
				while (true){
<span class="fc" id="L1350">					second_choice_index=new Random().nextInt(count_dishes);</span>

<span class="pc bpc" id="L1352" title="1 of 2 branches missed.">					if (second_choice_index!=first_choice_index)</span>
<span class="fc" id="L1353">						break;	</span>
				}
<span class="fc" id="L1355">				System.out.println(second_choice_index);</span>

				while (true){
<span class="fc" id="L1358">					third_choice_index=new Random().nextInt(count_dishes);</span>
<span class="pc bpc" id="L1359" title="2 of 4 branches missed.">					if ((third_choice_index!=first_choice_index) &amp;&amp; third_choice_index!=second_choice_index)</span>
<span class="fc" id="L1360">						break;	</span>
				}
<span class="fc" id="L1362">				System.out.println(third_choice_index);</span>
				
<span class="fc" id="L1364">				print_message=&quot;1.&quot;+menu_name.get(first_choice_index)+&quot; &quot;+price.get(first_choice_index)+&quot;\n&quot;;</span>
<span class="fc" id="L1365">				print_message=print_message+&quot;2.&quot;+menu_name.get(second_choice_index)+&quot; &quot;+price.get(second_choice_index)+&quot;\n&quot;;</span>
<span class="fc" id="L1366">				print_message=print_message+&quot;3.&quot;+menu_name.get(third_choice_index)+&quot; &quot;+price.get(third_choice_index)+&quot;\n&quot;;</span>
<span class="fc" id="L1367">				print_message=print_message+&quot;* means that the meal is commonly eaten at restaurants\n&quot;;</span>
				
				
<span class="fc" id="L1370">				break;</span>
			}
			break;
			}
			default:
				break;
			}	
<span class="fc" id="L1377">			connection.close();</span>
<span class="fc" id="L1378">			return print_message;</span>
<span class="fc" id="L1379">			}catch(Exception e){</span>
<span class="fc" id="L1380">				System.out.println(e);</span>
			}	
<span class="fc" id="L1382">			return null;</span>
		}
		
	
	
	private Connection getConnection() throws URISyntaxException, SQLException {
		Connection connection;
<span class="fc" id="L1389">		URI dbUri = new URI(System.getenv(&quot;DATABASE_URL&quot;));</span>

<span class="fc" id="L1391">		String username = dbUri.getUserInfo().split(&quot;:&quot;)[0];</span>
<span class="fc" id="L1392">		String password = dbUri.getUserInfo().split(&quot;:&quot;)[1];</span>
<span class="fc" id="L1393">		String dbUrl = &quot;jdbc:postgresql://&quot; + dbUri.getHost() + ':' + dbUri.getPort() + dbUri.getPath() +  &quot;?ssl=true&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory&quot;;</span>

		//log.info(&quot;Username: {} Password: {}&quot;, username, password);
		//log.info (&quot;dbUrl: {}&quot;, dbUrl);
		
<span class="fc" id="L1398">		connection = DriverManager.getConnection(dbUrl, username, password);</span>

<span class="fc" id="L1400">		return connection;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.8.201612092310</span></div></body></html>